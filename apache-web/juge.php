<?php 


function getRandomStr($len, $special=false){
    $chars = array(
        "a", "b", "c", "d", "e", "f", "0", "1", "2",
        "3", "4", "5", "6", "7", "8", "9"
    );

    if($special){
        $chars = array_merge($chars, array(
            "!", "@", "#", "$", "?", "|", "{", "/", ":", ";",
            "%", "^", "&", "*", "(", ")", "-", "_", "[", "]",
            "}", "<", ">", "~", "+", "=", ",", "."
        ));
    }

    $charsLen = count($chars) - 1;
    shuffle($chars);                            //打乱数组顺序
    $str = '';
    for($i=0; $i<$len; $i++){
        $str .= $chars[mt_rand(0, $charsLen)];    //随机取出一位
    }
    return $str;
}



    $rand = getRandomStr(32);

    if (isset($_COOKIE["user"]) and isset($_COOKIE["password"]))
    {  
        if(!isset($_COOKIE["token"]))
        {
            setcookie("token",$rand);
            $con = mysqli_connect("127.0.0.1","root","");
            if (!$con)
              {
              die('Could not connect: ' . mysql_error());
              }

            mysqli_select_db($con,"netsec");
            $sql = 'insert into tokenlist(id,token) values ('.$_COOKIE["user"].',"'.$rand.'");';
            mysqli_query($con,$sql);
        }
        $url="location:main.php";
        header($url);
    }
    else
    {
            echo "<script>
alert(\"login at index!\");
window.history.go(-1);
</script>";
    }

 ?>