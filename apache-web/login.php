<?php
$servername="localhost";
$username="root";
$password="passwd";
$db="netsec";

function getRandomStr($len, $special=false){
    $chars = array(
        "a", "b", "c", "d", "e", "f", "0", "1", "2",
        "3", "4", "5", "6", "7", "8", "9"
    );

    if($special){
        $chars = array_merge($chars, array(
            "!", "@", "#", "$", "?", "|", "{", "/", ":", ";",
            "%", "^", "&", "*", "(", ")", "-", "_", "[", "]",
            "}", "<", ">", "~", "+", "=", ",", "."
        ));
    }

    $charsLen = count($chars) - 1;
    shuffle($chars);                            //打乱数组顺序
    $str = '';
    for($i=0; $i<$len; $i++){
        $str .= $chars[mt_rand(0, $charsLen)];    //随机取出一位
    }
    return $str;
}
$rand = getRandomStr(32);

$con = mysqli_connect($servername, $username, $password, $db);
if (!$con)
  {
   die("Connection failed: " . mysqli_connect_error());
  }

$ids=$_POST[id];
$passwords=$_POST[password];
echo $ids;

$sql1 = 'insert into tokenlist(id,token) values ('.$ids.',"'.$rand.'");';
$sql = 'select id from User where id ='.$ids.' and password='.$passwords.';';
$result=mysqli_query($con,$sql);

if(mysqli_num_rows($result)&&mysqli_query($con,$sql1))
{
    setcookie("user",$ids, time()+3600);
    setcookie("password",$passwords, time()+3600);
    setcookie("token",$rand);
    $url="location:main.php";
    header($url);
}
else
{
    echo "badbad!";
}

mysqli_close($con);
?>
